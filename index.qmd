---
title: Machine Learning Workflow Orchestration
subtitle: Flyte & StreamFlow
author: Bernd Doser
date: 2024/10/07
date-format: "MMMM YYYY"
institute: "[HITS](https://h-its.org)"
format:
  revealjs:
    logo: images/HITS_RGB_eng.jpg
    footer: "ML Workflow Orchestration (Bernd Doser, HITS)"
    slide-number: true
    highlight-style: a11y
    width: 1300
---

## Why do we need a workflow orchestration

- To manage the flow of data and dependencies between tasks
- To manage the execution of tasks

## How we can define a workflow

- Using a general purpose programming languages (e.g Python)
- Using a domain specific language (e.g. CWL)
- Using a graphical user interface

## Orchestration Requirements

- **Reproducibility**: Ensure your experiments are reproducible by tracking the code, data, model, and environment used in each run.
- **Resource management**: Manage resources efficiently by running tasks in parallel and optimizing resource usage.
- **Scalability**: Scale your workflows to handle large datasets and complex pipelines.
- **Monitoring**: Track the progress of workflows and monitor their performance and results.
- **Collaboration**: Enable collaboration between team members by sharing code, data, and results.


<!--
- Easy deployment of the workflow infrastructure
- Flexible pipeline definition
- Monitoring status, execution times, and results
- Fast pipeline for big data (S3 / Filesystem)
- Integration of Containers
- Integration of HPC clusters (SLURM / Apptainers) -->


## Example Workflow

![](images/flyte-ui_mnist-workflow.png)


## File, Block, and Object Storage

- Differ between storage type and storage access type (file, block, object)
- Throughput vs Latency
  - Traditional: object storage is throughput optimized whereas file/block storage is latency optimized
- Object storage uses RESTful API (cloud-native)
- File uses POSIX, Block uses FC/SCSI

## Block Storage

- Data is divided in uniformly sized blocks
- Blocks ca stored across different storage environments
- Blocks do not contain any information about the content
- local SSD

## File Storage

- Hierarchical structure in files and directories
- NFS 

## Feed the Beast


## Flyte vs StreamFlow

:::: {.columns}

::: {.column width="50%"}
### Flyte
  - Kubernetes and S3 storage
  - Flexible workflow using python function decorators `@task` and `@workflow`
  - Add HPC resources to Kubernetes
:::

::: {.column width="50%"}
### StreamFlow
  - Common workflow language (CWL)
  - No special environment needed
  - SLURM plugin available
:::

::::

## Flyte 

- [Flyte](https://flyte.org/) evaluation setup
  - [k3s](https://k3s.io/): Lightweight Kubernetes
  - [MinIO](https://min.io/): High-performance, S3 compatible object store
- Parallelization: Automatically managed by task dependencies
- Versioning, caching, dynamic workflows available
- Integration of HPC resources
  - Custom Flyte agent using SLURM Rest API (not available yet)
  - Kubernetes agent: GPU node with 4x NVIDIA A40 cards


## Flyte: Example

```python
{{< include code/flyte_example.py >}}
```


## StreamFlow

- [Common Workflow Language (CWL)](https://www.commonwl.org/) as open standard
- [BioExcel CoE Building Blocks](https://bioexcel.eu/biobb-new/) is using CWL for interoperable and reproducible biomolecular simulation workflows.
- StreamFlow connects CWL with HPC
- Supports SLURM, Singularity and Containers
- [Web service for visualization](https://view.commonwl.org/)

<!-- - VSCode extension: [benten-cwl](https://marketplace.visualstudio.com/items?itemName=sbg-rabix.benten-cwl) -->


## StreamFlow Architecture

![](images/streamflow-model.png){height="500"}


## Supported Features

  - [Parallelization](https://www.commonwl.org/features/#parallelization-and-scale-with-cwl)
  - [Caching](https://www.commonwl.org/user_guide/topics/troubleshooting.html#run-cwltool-with-cachedir)
    (vs [Flyte caching](https://docs.flyte.org/en/latest/user_guide/development_lifecycle/caching.html#caching))
  - Nested workflows
  - Looping / scattering tasks
  - Conditional workflows
  - VSCode extension: [benten-cwl](https://marketplace.visualstudio.com/items?itemName=sbg-rabix.benten-cwl)
  - [Web service for visualization](https://view.commonwl.org/) -->


## StreamFlow: Example

```yaml
{{< include code/streamflow_example.cwl >}}
```
